## MMU
  - Memory Management Unit
  - run-time mapping 
  - from logical to physical address space
  - relocation register
---
## virtual memory
  - original idea
    - to expand the physical memory
    - with a reserved space in hard disc called Page file
    - which the program would view as RAM
    - Disc Paging
---
## virtual memory
  - the collection of all page frames of process
  - comprises its Working Set.
---
## page table
  - the process pages in virtual memory mapped 
  - either to its page frame in physical memory
  - or initialized to the page location on hard disc
  - page tables created on the physical memory
---
## page table
  - a page is a virtual entity
  - its memory space has no physical existence
  - a page exists only in the form of a page address 
  - on page table which is a physical entity
---
## page table
  - page table is essentially the Virtual Memory 
---
## page table
  - index  represent the virtual page address
  - Page Table Entry(PTE) contains 
  - the corresponding page frame address in physical memory
  - Control bits 
    - valid bit
    - modified bit
    - Read/Write access protection bits 
    - Process ID bits
---
## page 
  - page size : typically between 1KB and 8KB
  - generally 4KB for 32 bit systems
  - 4096 bytes = 2^12 bytes
  - Number of Pages = Virtual Memory Space / Page Size
  = 2^32 / 2^12 = 2^20 = 1048576
---
## memory address
  - 2^32 = 2^20 * 2^12
  - 32 bit address generated by Program Counter
  = 20 bit Virtual Page Number(VPN) + 12 bit OFFSET
---
## page Frame array
  - 20 bit array address
  - Physical Page Number(PPN)
  - the address of a physical memory location
  - formed by concatenating PPN with offset
---
## Demand Paging
  - a part of process in page table to memory
  - comprising of only th essential tasks
  - improvement on pure virtual paging
---
## demand paging
  - all information related to process in Process Control Block(PCB)
  - classified as process identification data, process state data,
  - process control data
  - process identification data
    - Process ID and Page Table Base Address(PTBA)
    - starting address of a page table in physical memory
---
## demand paging
  - every CPU  has a Page Table Base Register(PTBR) 
  - to store the current page table base address
---
## Program Counter
  - high order bits : VPN
  - a counter that increments by virtual page number
  - low order bits : Offset
  - a byte counter to index into the memory elements whith a page
  - VPN are identical for all page tables
---
## MMU
  - memory management unit of CPU
  - refers to the page table base address in PTBR
  - to access the page table in physical memory
  - then refers to VPN part of the virtual address in PC
  - to index into page table
  - to identify the PPN(physical page number) 
  - corresponding to the VPN
---
## MMU
  - generates physical address 
  - by concatenating PPN with Offset part 
  - of virtual address in the PC
  - stores this physical address on the Memory Address Register(MAR)
---
## MMU
  - the CPU reads the address in MAR(memory address register)
  - to fetch instruction from the physical memory and execute it
---
## demand paging
  - a process initiates
  - operating system creates page table
  - by mapping virtual addresses to physical address 
  - of process files in hard disc
---
## demand paging
  - OS marks Valid bit = 1 for pages in page table
  - tasks required to be loaded in memory
  - pages not to be loaded marked as invalid
  - page frames created on physical memory
  - loaded with codes from the process files in hard disc
  - PPN replace physical address of page in page table
  - initailized with the file location in hard disc
---
## page fault
  - MMU generates page fault
  - virtual page address has missing frame number
  - frame number does not exist in physical memory
---
## page handler
  - ensure page request is genuine
    - not genuine -> process terminated
  - if genuine, OS determines missing code/data and loads it from hard disc to free location in memory creating a new page frame
  - new page frame address updated on faulting page in page table the page marked as valid
---
## demand paging
  - process needs to execute a new task
  - OS creates the new task in physical memory
  - updates one or more VPN of the task
  - initailly marked invalid on the page table
  - with valid bit
---
## Translation Lookaside Buffer(TLB)
  - cache maintained on the registers of the processor's MMU
  - to store the recently used pages of the page table
  - when MMU needs to read page from page table in memory
  - first tries to read it from the TLB by default
  - much faster than reading from the memory
  - if page does not exist in TLB 
  - then MMU first copies the page from page table 
  - into the TLB then reads it from the TLB
---
## TLB(translation lookaside buffer)
  - succeeds because of the statistical principle of locality
  - temporal locality supported by caching of recently accessed pages in TLB
  - spatial locality supported by Preparing
  - to cache all valid pages in page table 
  - before they are actually requested
  - on page fault, all pages earlier part of working set are added to the TLB instead of only the faulting page
---
## TLB(translation lookaside buffer)
  - TLB hit
  -  page found in the TLB
  - TLB miss
  - page not found
  - TLB hit eliminates the need to access page table in memory
  - TLB miss incurs page table access in memory
  - the principle of locality is the cornerstone of TLB success
  - with a hit rate of more than 99%
 

